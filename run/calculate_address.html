<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Test</title>
</head>
<body>

	<input type="text" name="input" id='ipaddress'>
	<select id="masksSelector">
		<option>--Select--</option>
	</select>
	<button onclick='print_data()'>Submit</button>

	<script type="text/javascript">

		function convertToDec(data) {
			//split data
			let dataSplit = data.split('.');
			//var for bin in dec
			let decAddress = "";
			for(let i=0; i<dataSplit.length; ++i) {
				//convert from bin to dec
				decAddress += parseInt(dataSplit[i], 2);
				//if i != last data from split append dot 
				//after append convert data octec 
				if(i != dataSplit.length-1) {
					decAddress += '.';
				}
			}

			return decAddress;
		} 


		function convertToBin(data) {
			//split address after dot
			const splitArray = data.split('.');
			if(splitArray.length < 4) {
				alert("Error");
			}

			else {
				//array for bin values
				const binArray = [];
				for(let i=0; i<splitArray.length; ++i) {
					//convert from string into int
					let intType = parseInt(splitArray[i]);
					//if conver to INT number is NaN break looop
					if(isNaN(intType)) {
						alert("Different data");
						break;
					}
					//if number isn't NaN conbert numbers to bin
					else {
						//convert numbers from dec to bin
						let bin = intType.toString(2);
						//append 0 to convert number
						let addZero = bin.padStart(8,'0');
						//append convert number to array for bin numbers
						binArray.push(addZero);
					}
				}

				let binAddress = "";
				//if bunArray length is 4 show results
				if(binArray.length == 4) {
					for(let i=0; i<binArray.length; i++) {
						if(i == binArray.length-1) {
							binAddress += binArray[i];
						}
						else {
							binAddress += binArray[i]+".";
						}

					}
					return binAddress;
				}
			}
		}

		function get_mask() {
			//select
			let select = document.querySelector("#masksSelector");
			
			//import JSON file
			let request = new Request("masks.json");
			//get data from JSON file
			fetch(request)
				//
				.then(function(resp) {
					//return JS Object
					return resp.json();
				})
				//get data from Object
				.then(function(data) {
					for(let i=1; i<=32; ++i) {
						//create option
						let option = document.createElement("option");
						//set class for option
						option.class = "option";
						//set text for option
						option.innerHTML = "/"+i+" "+data.masks[i];
						//set value
						option.value = data.masks[i];
						//and append option to select
						select.appendChild(option);
					}	
				});
			

		}

		function network_address() {
			//get ip value
			let IPaddress = document.querySelector('#ipaddress').value;
			//run previous function with convert to bin
			let ipBin = convertToBin(IPaddress);

			//get mask value from select
			let mask = document.querySelector('#masksSelector').value;
			//convert mask to bianry
			let maskBin = convertToBin(mask);

			//network addres in binary
			let networkAddresBin = "";
			for(let i=0; i<ipBin.length; ++i) {
				//if ipBin[i] and maskBin[i] != '.'
				//append AND validation to networkAddresBin
				if(ipBin[i] != '.' && maskBin != '.') {
					networkAddresBin += (ipBin[i]&maskBin[i]);
				}
				//else ipBin[i] and maskBin[i] == '.'
				//append dot to networkAddresBin
				else if(ipBin[i] == '.' && maskBin[i] == '.') {
					networkAddresBin += '.';
				}

			}

			//var to networkAddress in dec
			let networkAddres = convertToDec(networkAddresBin);

			return networkAddres;

		}


		function broadcast_address() {
			//get mask value from select
			let mask = document.querySelector('#masksSelector').value;
			//convert mask to bianry
			let maskBin = convertToBin(mask);

			//netowrk address
			const netowrkAddress = network_address();
			//NOT mask bin
			let notMaskBin = "";
			for(let i=0; i<maskBin.length; ++i) {
				//if char in mas bin is 1 add 0
				if(maskBin[i] == '1') {
					notMaskBin+='0';
				}
				//if char in mas bin is 0 add 1
				else if(maskBin[i] == '0') {
					notMaskBin+='1';
				}
				//if char in mas bin is . add .
				else if(maskBin[i] == '.') {
					notMaskBin+='.';
				}
			}

			//convert NOT bin mask to dec
			let maskNotDec = convertToDec(notMaskBin);
			//split not dec mask 
			let splitMaskNotDec = maskNotDec.split('.');
			//split netowrk address
			let splitNetworkAddress = netowrkAddress.split('.');

			//broadcast address
			let broadcastAddress = "";
			for(let i=0; i<splitNetworkAddress.length; ++i) {
				//add data to broadcast var and convert to INT type
				broadcastAddress += (parseInt(splitMaskNotDec[i]) + parseInt(splitNetworkAddress[i]));
				//add dot after add data to new var
				if(i != splitNetworkAddress.length-1) {
					broadcastAddress += '.';
				}
			}

			return broadcastAddress;

		}

		function print_data() {
			//get input value
			let IPaddress = document.querySelector('#ipaddress').value;
			//get mask value from select
			let mask = document.querySelector('#masksSelector').value;

			console.log("Ip address: ",IPaddress);
			console.log("Mask: ",mask);
			console.log("Network address: ",network_address());
			console.log("Broadcast address: ",broadcast_address());
		}



		window.onload = function() {
			get_mask();
		}



	</script>

</body>
</html>